<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>60s API Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --pre-bg: #f9fafb;
            --key-color: #1d4ed8;
            --string-color: #10b981;
            --number-color: #f59e0b;
            --boolean-color: #6b7280;
            --border-radius: 8px;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding-top: 20px;
        }
        .container-fluid {
            max-width: 1400px;
            margin: 0 auto;
        }
        .sidebar {
            min-height: calc(100vh - 100px);
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            position: sticky;
            top: 20px;
            background-color: var(--card-bg);
            border-right: 1px solid #dee2e6;
            padding: 20px;
        }
        .content-area {
            min-height: calc(100vh - 100px);
            overflow-y: auto;
            padding: 20px;
        }
        .card {
            background-color: var(--card-bg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }
        #json-container {
            background: var(--pre-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            height: auto;
            overflow-y: auto;
            font-size: 0.9rem;
            transition: opacity 0.3s ease;
            opacity: 0;
            position: relative;
        }
        #json-container.loading::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 3px solid #ccc;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }
        #json-container.loaded {
            opacity: 1;
        }
        .json-item {
            display: block;
            margin-bottom: 5px;
            padding: 2px 5px;
            border-bottom: 1px solid #eee;
        }
        .json-key {
            color: var(--key-color);
            font-weight: bold;
            min-width: 120px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .json-value {
            flex-grow: 1;
            word-break: break-word;
            white-space: normal;
        }
        .json-string { color: var(--string-color); }
        .json-number { color: var(--number-color); }
        .json-boolean, .json-null { color: var(--boolean-color); }
        .json-link a {
            color: var(--key-color);
            text-decoration: underline;
        }
        .json-link a:hover {
            color: #1e40af;
        }
        .json-collapsible {
            cursor: pointer;
            user-select: none;
            display: inline;
            margin-left: 5px;
        }
        .json-collapsible::before {
            content: '▼';
            margin-right: 5px;
        }
        .json-collapsible.collapsed::before {
            content: '▶';
        }
        .json-collapsible-content {
            display: block;
            margin-left: 0 !important;
            padding-left: 0 !important;
        }
        .json-collapsible-content.collapsed {
            display: none;
        }
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 6px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
            transform: scale(1.05);
        }
        .btn-primary:disabled {
            background-color: #a3a3a3;
            border-color: #a3a3a3;
            cursor: not-allowed;
            transform: none;
        }
        .accordion-button {
            font-weight: bold;
            color: var(--text-color);
        }
        .accordion-button:not(.collapsed) {
            color: var(--primary-color);
            background-color: #e0e7ff;
        }
        .list-group-item-action {
            cursor: pointer;
        }
        .list-group-item-action:hover {
            background-color: #e0e7ff;
        }
        .list-group-item-action.active {
            background-color: #e0e7ff;
            color: var(--primary-color);
            font-weight: bold;
        }
        .form-control {
            border-radius: 6px;
            border: 1px solid #d1d5db;
            transition: border-color 0.3s ease;
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .domain-select {
            max-width: 400px;
            margin-bottom: 20px;
        }
        .success-tip {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #10b981;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1050;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .success-tip.show {
            opacity: 1;
            transform: translateY(0);
        }
        .api-info {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 10px;
            padding: 8px;
            background-color: #f9fafb;
            border-radius: 4px;
            border-left: 3px solid var(--primary-color);
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        @media (max-width: 768px) {
            .sidebar {
                max-height: none;
                position: relative;
                top: 0;
            }
            .content-area {
                padding: 15px;
            }
            .json-key {
                min-width: 80px;
            }
            #json-container {
                font-size: 0.85rem;
            }
            .domain-select {
                max-width: 100%;
            }
            .success-tip {
                top: 10px;
                right: 10px;
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 左侧导航 -->
            <div class="col-md-3 sidebar">
                <h5 class="mb-3">API 导航</h5>
                <div class="mb-3">
                    <label for="baseUrlSelect" class="form-label">选择 API 域名：</label>
                    <select id="baseUrlSelect" class="form-select domain-select">
                        <option value="60s.2207117672.workers.dev/v2" selected>个人部署</option>
                        <option value="https://60s.viki.moe/v2">官方主域名: https://60s.viki.moe</option>
                        <option value="https://60s.b23.run/v2">备用1: https://60s.b23.run</option>
                        <option value="https://60s-cf.viki.moe/v2">备用2: https://60s-cf.viki.moe</option>
                        <option value="https://60s.114128.xyz/v2">备用3: https://60s.114128.xyz</option>
                        <option value="https://60s-cf.114128.xyz/v2">备用4: https://60s-cf.114128.xyz</option>
                    </select>
                </div>
                <div id="api-navigation" class="accordion"></div>
            </div>
            <!-- 右侧内容区 -->
            <div class="col-md-9 content-area">
                <h2 class="mb-4">API 响应数据</h2>
                <div id="api-content" class="card p-3">
                    <h5 id="api-title" class="mb-3">请选择一个API</h5>
                    <div id="api-params" class="mb-3"></div>
                    <button id="fetch-btn" class="btn btn-primary mb-3" style="display: none;">获取数据</button>
                    <div id="json-container"></div>
                    <div id="api-info" class="api-info" style="display: none;">
                        数据来自官方/权威源头，以确保稳定与实时。<br>
                        开源地址: <a href="https://github.com/vikiboss/60s" target="_blank">https://github.com/vikiboss/60s</a><br>
                        反馈群: 595941841
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="success-tip" class="success-tip">
        <i class="bi bi-check-circle-fill"></i> 调用成功
    </div>

    <script>
        let baseUrl = document.getElementById('baseUrlSelect').value;
        let currentApi = null;
        let lastResponses = {};
        let accordionInstances = {};

        // 域名切换事件
        document.getElementById('baseUrlSelect').addEventListener('change', function() {
            baseUrl = this.value;
            console.log('API 域名切换到:', baseUrl);
            if (currentApi) {
                loadApiContent(currentApi, true);
            }
        });

        // API 数据
        const apiData = [
            {
                name: '日更资讯',
                apis: [
                    { title: '每天 60 秒读懂世界', endpoint: '/60s?encoding=json', params: [] },
                    { title: '必应每日壁纸', endpoint: '/bing', params: [] },
                    { title: '当日货币汇率', endpoint: '/exchange_rate', params: [] },
                    { title: '历史上的今天', endpoint: '/today_in_history', params: [] }
                ]
            },
            {
                name: '热门榜单',
                apis: [
                    { title: '抖音热搜', endpoint: '/douyin', params: [] },
                    { title: '小红书热点', endpoint: '/rednote', params: [] },
                    { title: '哔哩哔哩热搜', endpoint: '/bili', params: [] },
                    { title: '微博热搜', endpoint: '/weibo', params: [] },
                    { title: '百度实时热搜', endpoint: '/baidu/realtime', params: [] },
                    { title: '百度电视剧榜', endpoint: '/baidu/teleplay', params: [] },
                    { title: '百度贴吧话题榜', endpoint: '/baidu/tieba', params: [] },
                    { title: '头条热搜榜', endpoint: '/toutiao', params: [] },
                    { title: '知乎话题榜', endpoint: '/zhihu', params: [] },
                    { title: '懂车帝热搜', endpoint: '/dongchedi', params: [] },
                    { title: '网易云榜单列表', endpoint: '/ncm-rank', params: [] },
                    { title: '网易云榜单详情', endpoint: '/ncm-rank/detail', params: [{name: 'id', example: '19723756'}] },
                    { title: '猫眼票房榜', endpoint: '/maoyan', params: [] },
                    { title: 'HackerNews 热门帖子', endpoint: '/hacker-news/top', params: [] }
                ]
            },
            {
                name: '实用功能',
                apis: [
                    { title: 'Epic Games 免费游戏', endpoint: '/epic', params: [] },
                    { title: '公网 IP 地址', endpoint: '/ip', params: [] },
                    { title: '农历信息（开发中）', endpoint: '/lunar', params: [] },
                    { title: '实时天气', endpoint: '/weather', params: [{name: 'query', example: '呼和浩特'}] },
                    { title: '天气预报', endpoint: '/weather/forecast', params: [{name: '呼和浩特', example: '呼和浩特'}] },
                    { title: '生成二维码', endpoint: '/qrcode', params: [{name: 'text', example: 'https://example.com'}] },
                    { title: '百度百科词条', endpoint: '/baike', params: [{name: 'word', example: '人工智能'}] },
                    { title: '在线翻译', endpoint: '/fanyi', params: [{name: 'text', example: 'Hello'}, {name: 'from', example: 'en'}, {name: 'to', example: 'zh-CHS'}] },
                    { title: '在线翻译支持语言', endpoint: '/fanyi/langs', params: [] },
                    { title: '链接 OG 信息', endpoint: '/og', params: [{name: 'url', example: 'https://example.com'}] },
                    { title: '哈希/解压/压缩', endpoint: '/hash', params: [{name: 'type', example: 'md5'}, {name: 'text', example: 'hello'}] },
                    { title: '身体健康分析', endpoint: '/health', params: [{name: 'height', example: '170'}, {name: 'weight', example: '60'}, {name: 'age', example: '25'}, {name: 'gender', example: 'male'}] },
                    { title: '密码生成器', endpoint: '/password', params: [{name: 'length', example: '12'}] },
                    { title: '密码强度检测', endpoint: '/password/check', params: [{name: 'password', example: 'abc123'}] },
                    { title: '随机颜色/颜色转换', endpoint: '/color', params: [{name: 'format', example: 'hex'}] },
                    { title: '配色方案', endpoint: '/color/palette', params: [{name: 'color', example: '#ff0000'}, {name: 'mode', example: 'analogic'}] }
                ]
            },
            {
                name: '消遣娱乐',
                apis: [
                    { title: '随机唱歌音频', endpoint: '/changya', params: [] },
                    { title: '随机一言', endpoint: '/hitokoto', params: [] },
                    { title: '随机运势', endpoint: '/luck', params: [] },
                    { title: '随机 JS 趣味题', endpoint: '/awesome-js', params: [] },
                    { title: '随机搞笑段子', endpoint: '/duanzi', params: [] },
                    { title: '随机发病文学', endpoint: '/fabing', params: [] },
                    { title: '随机答案之书', endpoint: '/answer', params: [] },
                    { title: '随机 KFC 文案', endpoint: '/kfc', params: [] },
                    { title: '随机冷笑话', endpoint: '/dad-joke', params: [] }
                ]
            }
        ];

        // 生成API的唯一标识符
        function getApiId(api) {
            return encodeURIComponent(api.title);
        }

        // 显示成功提示
        function showSuccessTip() {
            const tip = document.getElementById('success-tip');
            tip.classList.add('show');
            setTimeout(() => {
                tip.classList.remove('show');
            }, 2000);
        }

        // 过滤API响应数据，只保留data字段
        function filterApiResponse(data) {
            if (data && typeof data === 'object') {
                // 检查是否包含标准响应结构
                if (data.hasOwnProperty('code') && data.hasOwnProperty('message') && data.hasOwnProperty('data')) {
                    // 显示API信息
                    document.getElementById('api-info').style.display = 'block';
                    // 返回data字段内容
                    return data.data;
                }
            }
            // 如果不是标准结构，隐藏API信息并返回原始数据
            document.getElementById('api-info').style.display = 'none';
            return data;
        }

        // 格式化 JSON 为卡片式 HTML
        function formatJson(data) {
            // 首先过滤响应数据
            const filteredData = filterApiResponse(data);
            
            let html = '';
            if (typeof filteredData === 'object' && filteredData !== null) {
                if (Array.isArray(filteredData)) {
                    if (filteredData.length === 0) {
                        html += '<div class="json-item"><span class="json-key">Array</span><span class="json-value">[ ]</span></div>';
                    } else {
                        filteredData.forEach((item, index) => {
                            html += `<div class="json-item"><span class="json-key">${index}</span><span class="json-value">${formatValue(item)}</span></div>`;
                        });
                    }
                } else {
                    const entries = Object.entries(filteredData);
                    if (entries.length === 0) {
                        html += '<div class="json-item"><span class="json-key">Object</span><span class="json-value">{ }</span></div>';
                    } else {
                        entries.forEach(([key, value]) => {
                            html += `<div class="json-item"><span class="json-key">&quot;${key}&quot;</span><span class="json-value">${formatValue(value)}</span></div>`;
                        });
                    }
                }
            } else {
                html += `<div class="json-item"><span class="json-key">Result</span><span class="json-value">${formatValue(filteredData)}</span></div>`;
            }
            return html;
        }

        // 格式化单个值，支持高亮和链接
        function formatValue(value) {
            if (value === null) return '<span class="json-null">null</span>';
            if (typeof value === 'boolean') return `<span class="json-boolean">${value}</span>`;
            if (typeof value === 'number') return `<span class="json-number">${value}</span>`;
            if (typeof value === 'string') {
                const urlRegex = /^(https?:\/\/[^\s]+)$/;
                if (urlRegex.test(value)) {
                    return `<span class="json-link"><a href="${value}" target="_blank">${value}</a></span>`;
                }
                return `<span class="json-string">&quot;${value}&quot;</span>`;
            }
            if (typeof value === 'object' && value !== null) {
                let content = '';
                if (Array.isArray(value)) {
                    if (value.length === 0) {
                        content = '<div class="json-item"><span class="json-key"></span><span class="json-value">[ ]</span></div>';
                    } else {
                        content = value.map((item, index) => {
                            return `<div class="json-item"><span class="json-key">${index}</span><span class="json-value">${formatValue(item)}</span></div>`;
                        }).join('');
                    }
                } else {
                    const entries = Object.entries(value);
                    if (entries.length === 0) {
                        content = '<div class="json-item"><span class="json-key"></span><span class="json-value">{ }</span></div>';
                    } else {
                        content = entries.map(([key, val]) => {
                            return `<div class="json-item"><span class="json-key">&quot;${key}&quot;</span><span class="json-value">${formatValue(val)}</span></div>`;
                        }).join('');
                    }
                }
                return `<span class="json-collapsible" onclick="this.classList.toggle('collapsed'); this.nextElementSibling.classList.toggle('collapsed');">${Array.isArray(value) ? '[' : '{'}</span><div class="json-collapsible-content">${content}</div>`;
            }
            return value.toString();
        }

        // 函数：构建左侧导航
        function buildNavigation(data) {
            const navContainer = document.getElementById('api-navigation');
            navContainer.innerHTML = '';
            
            data.forEach((category, catIndex) => {
                const accordionItem = document.createElement('div');
                accordionItem.className = 'accordion-item';
                accordionItem.innerHTML = `
                    <h2 class="accordion-header">
                        <button class="accordion-button ${catIndex === 0 ? '' : 'collapsed'}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${catIndex}">
                            ${category.name}
                        </button>
                    </h2>
                    <div id="collapse${catIndex}" class="accordion-collapse collapse ${catIndex === 0 ? 'show' : ''}" data-bs-parent="#api-navigation">
                        <div class="accordion-body p-0">
                            <ul class="list-group list-group-flush">
                                ${category.apis.map((api, apiIndex) => `
                                    <li class="list-group-item list-group-item-action" data-cat-index="${catIndex}" data-api-index="${apiIndex}" data-api-id="${getApiId(api)}">
                                        ${api.title}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                navContainer.appendChild(accordionItem);
                
                // 初始化Bootstrap折叠组件
                const collapseElement = document.getElementById(`collapse${catIndex}`);
                accordionInstances[`collapse${catIndex}`] = new bootstrap.Collapse(collapseElement, {
                    toggle: false
                });
            });

            // 添加点击事件
            document.querySelectorAll('.list-group-item-action').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.list-group-item-action').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    const catIndex = item.dataset.catIndex;
                    const apiIndex = item.dataset.apiIndex;
                    const api = data[catIndex].apis[apiIndex];
                    
                    // 更新URL hash
                    window.location.hash = getApiId(api);
                    
                    loadApiContent(api, false);
                });
            });

            // 检查URL hash并选择对应的API
            const hash = window.location.hash.substring(1);
            if (hash) {
                // 查找对应的API项
                let targetApi = null;
                let targetCategoryIndex = -1;
                let targetApiIndex = -1;
                
                data.forEach((category, catIndex) => {
                    category.apis.forEach((api, apiIndex) => {
                        if (getApiId(api) === hash) {
                            targetApi = api;
                            targetCategoryIndex = catIndex;
                            targetApiIndex = apiIndex;
                        }
                    });
                });
                
                if (targetApi) {
                    console.log('从URL hash加载API:', targetApi.title);
                    
                    // 展开对应的分类
                    Object.keys(accordionInstances).forEach(key => {
                        if (key === `collapse${targetCategoryIndex}`) {
                            accordionInstances[key].show();
                        } else {
                            accordionInstances[key].hide();
                        }
                    });
                    
                    // 选中对应的API项
                    const targetItem = document.querySelector(`[data-api-id="${hash}"]`);
                    if (targetItem) {
                        targetItem.click();
                    }
                } else {
                    // 默认选中第一个 API
                    selectFirstApi(data);
                }
            } else {
                // 默认选中第一个 API
                selectFirstApi(data);
            }
        }

        // 选择第一个API
        function selectFirstApi(data) {
            const firstItem = document.querySelector('.list-group-item-action');
            if (firstItem) {
                console.log('默认选中第一个 API:', firstItem.textContent);
                firstItem.click();
            } else {
                console.error('未找到任何 API 导航项');
            }
        }

        // 函数：加载右侧内容
        function loadApiContent(api, forceFetch = false) {
            console.log('加载 API:', api.title, forceFetch ? '(强制获取)' : '(可能使用缓存)');
            currentApi = api;
            
            const paramsContainer = document.getElementById('api-params');
            const fetchBtn = document.getElementById('fetch-btn');
            const jsonContainer = document.getElementById('json-container');
            const apiTitle = document.getElementById('api-title');
            
            paramsContainer.innerHTML = '';
            fetchBtn.style.display = 'block';
            apiTitle.textContent = api.title;

            if (api.params.length > 0) {
                api.params.forEach(param => {
                    const inputGroup = document.createElement('div');
                    inputGroup.className = 'input-group mb-2';
                    inputGroup.innerHTML = `
                        <span class="input-group-text">${param.name}</span>
                        <input type="text" class="form-control api-param" data-param-name="${param.name}" value="${param.example || ''}" placeholder="输入${param.name}">
                    `;
                    paramsContainer.appendChild(inputGroup);
                });
            }
            
            fetchBtn.onclick = () => {
                console.log('手动点击获取数据:', api.title);
                fetchApiData(api, true);
            };
            
            // 检查是否有缓存数据，如果没有或强制获取则请求API
            const apiId = getApiId(api);
            if (forceFetch || !lastResponses[apiId]) {
                fetchApiData(api, true);
            } else {
                console.log('显示缓存的API响应:', api.title);
                jsonContainer.innerHTML = lastResponses[apiId];
                jsonContainer.classList.add('loaded');
                showSuccessTip();
            }
        }

        // 函数：请求 API 数据
        async function fetchApiData(api, updateCache = true) {
            const jsonContainer = document.getElementById('json-container');
            const fetchBtn = document.getElementById('fetch-btn');
            
            jsonContainer.classList.remove('loaded');
            jsonContainer.classList.add('loading');
            fetchBtn.disabled = true;
            
            let url = `${baseUrl}${api.endpoint}`;
            const params = [];
            
            // 收集参数值
            if (api.params.length > 0) {
                api.params.forEach(param => {
                    const input = document.querySelector(`[data-param-name="${param.name}"]`);
                    if (input && input.value) {
                        params.push({name: param.name, value: input.value});
                    }
                });
                
                if (params.length > 0) {
                    const queryString = params.map(p => `${p.name}=${encodeURIComponent(p.value)}`).join('&');
                    url += `${api.endpoint.includes('?') ? '&' : '?'}${queryString}`;
                }
            }
            
            console.log('请求 URL:', url);
            try {
                const response = await fetch(url);
                const data = await response.json();
                const formattedData = formatJson(data);
                
                jsonContainer.innerHTML = formattedData;
                
                // 更新缓存
                if (updateCache) {
                    const apiId = getApiId(api);
                    lastResponses[apiId] = formattedData;
                }
                
                // 显示成功提示
                showSuccessTip();
            } catch (error) {
                jsonContainer.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
                console.error('API 请求失败:', error);
            } finally {
                jsonContainer.classList.remove('loading');
                jsonContainer.classList.add('loaded');
                fetchBtn.disabled = false;
            }
        }

        // 启动导航构建
        console.log('开始构建导航...');
        buildNavigation(apiData);
    </script>
</body>
</html>